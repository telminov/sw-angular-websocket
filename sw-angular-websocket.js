(function() {
  var indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

  angular.module('swWebSocket', []).constant('WS_STATUSES', ['CONNECTING', 'OPEN', 'CLOSING', 'CLOSED']).constant('WS_CLOSE_STATUSES', ['CLOSING', 'CLOSED']).constant('WS_OPEN_STATUS', 'OPEN').factory('swWebSocket', function($q, $interval, $timeout, WS_STATUSES, WS_CLOSE_STATUSES, WS_OPEN_STATUS) {
    var swWebSocket;
    swWebSocket = (function() {
      function swWebSocket(wsUri) {
        this.wsUri = wsUri;
        this.durable = false;
        this.messagesToSend = [];
        this.startHandlers = [];
        this.messageHandlers = [];
        this.errorHandlers = [];
        this._socket = void 0;
      }

      swWebSocket.prototype.start = function(durable) {
        this._getSocket();
        if (durable) {
          return this.durable = true;
        }
      };

      swWebSocket.prototype.close = function() {
        this.durable = false;
        return this._socket.close();
      };

      swWebSocket.prototype.send = function(msg) {
        this.messagesToSend.push(msg);
        return this._getSocket();
      };

      swWebSocket.prototype.onStart = function(callback) {
        return this.startHandlers.push(callback);
      };

      swWebSocket.prototype.onMessage = function(callback) {
        return this.messageHandlers.push(callback);
      };

      swWebSocket.prototype.onError = function(callback) {
        return this.errorHandlers.push(callback);
      };

      swWebSocket.prototype.getStatus = function() {
        var status;
        status = void 0;
        if (this._socketExists()) {
          status = WS_STATUSES[this._socket.readyState];
        }
        return status;
      };

      swWebSocket.prototype.isOpen = function() {
        return this.getStatus() === WS_OPEN_STATUS;
      };

      swWebSocket.prototype.isClosed = function() {
        var ref;
        return ref = this.getStatus(), indexOf.call(WS_CLOSE_STATUSES, ref) >= 0;
      };

      swWebSocket.prototype._getSocket = function() {
        if (!this._isSocketActive()) {
          this._socket = this._createSocket();
        }
        return this._socket;
      };

      swWebSocket.prototype._createSocket = function() {
        var socket;
        socket = new WebSocket(this.wsUri);
        socket.onopen = (function(_this) {
          return function(event) {
            return _this._onSocketOpen(event);
          };
        })(this);
        socket.onclose = (function(_this) {
          return function(event) {
            return _this._onSocketClose(event);
          };
        })(this);
        socket.onmessage = (function(_this) {
          return function(event) {
            return _this._onSocketMessage(event);
          };
        })(this);
        socket.onerror = (function(_this) {
          return function(event) {
            return _this._onSocketError(event);
          };
        })(this);
        return socket;
      };

      swWebSocket.prototype._onSocketOpen = function(event) {
        var handler, i, len, ref;
        ref = this.startHandlers;
        for (i = 0, len = ref.length; i < len; i++) {
          handler = ref[i];
          handler(event.data);
        }
        return this._startSend();
      };

      swWebSocket.prototype._onSocketError = function(event) {
        var handler, i, len, ref, results;
        ref = this.errorHandlers;
        results = [];
        for (i = 0, len = ref.length; i < len; i++) {
          handler = ref[i];
          results.push(handler(event));
        }
        return results;
      };

      swWebSocket.prototype._onSocketClose = function() {
        var restartConnection;
        this._stopSend();
        if (this.durable) {
          restartConnection = (function(_this) {
            return function() {
              return _this._getSocket();
            };
          })(this);
          return $timeout(restartConnection, 2000);
        }
      };

      swWebSocket.prototype._startSend = function() {
        var sendMsg;
        sendMsg = (function(_this) {
          return function() {
            var msg, results;
            results = [];
            while (_this._messagesExists() && _this._isSocketActive()) {
              msg = _this.messagesToSend.shift();
              results.push(_this._getSocket().send(msg));
            }
            return results;
          };
        })(this);
        return this.stopSendPromise = $interval(sendMsg, 500);
      };

      swWebSocket.prototype._stopSend = function() {
        if (this.stopSendPromise !== void 0) {
          return $interval.cancel(this.stopSendPromise);
        }
      };

      swWebSocket.prototype._socketExists = function() {
        return this._socket !== void 0;
      };

      swWebSocket.prototype._isSocketActive = function() {
        return this._socketExists() && !this.isClosed();
      };

      swWebSocket.prototype._messagesExists = function() {
        return this.messagesToSend.length > 0;
      };

      return swWebSocket;

    })();
    return swWebSocket;
  });

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInN3LWFuZ3VsYXItd2Vic29ja2V0LmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUFBLE1BQUEsbUpBQUE7O0FBQUEsRUFBQSxPQUFPLENBQUMsTUFBUixDQUFlLGFBQWYsRUFBOEIsRUFBOUIsQ0FFQSxDQUFDLFFBRkQsQ0FFVSxhQUZWLEVBRXlCLENBQUMsWUFBRCxFQUFlLE1BQWYsRUFBdUIsU0FBdkIsRUFBa0MsUUFBbEMsQ0FGekIsQ0FHQSxDQUFDLFFBSEQsQ0FHVSxtQkFIVixFQUcrQixDQUFDLFNBQUQsRUFBWSxRQUFaLENBSC9CLENBSUEsQ0FBQyxRQUpELENBSVUsZ0JBSlYsRUFJNEIsTUFKNUIsQ0FNQSxDQUFDLE9BTkQsQ0FNUyxhQU5ULEVBTXdCLFNBQUMsRUFBRCxFQUFLLFNBQUwsRUFBZ0IsUUFBaEIsRUFBMEIsV0FBMUIsRUFBdUMsaUJBQXZDLEVBQTBELGNBQTFELEdBQUE7QUFDcEIsUUFBQSxXQUFBO0FBQUEsSUFBTTtBQUNXLE1BQUEscUJBQUMsS0FBRCxHQUFBO0FBQ1QsUUFBQSxJQUFJLENBQUMsS0FBTCxHQUFhLEtBQWIsQ0FBQTtBQUFBLFFBR0EsSUFBSSxDQUFDLE9BQUwsR0FBZSxLQUhmLENBQUE7QUFBQSxRQU1BLElBQUksQ0FBQyxjQUFMLEdBQXNCLEVBTnRCLENBQUE7QUFBQSxRQVNBLElBQUksQ0FBQyxhQUFMLEdBQXFCLEVBVHJCLENBQUE7QUFBQSxRQVVBLElBQUksQ0FBQyxlQUFMLEdBQXVCLEVBVnZCLENBQUE7QUFBQSxRQVdBLElBQUksQ0FBQyxhQUFMLEdBQXFCLEVBWHJCLENBQUE7QUFBQSxRQWFBLElBQUksQ0FBQyxPQUFMLEdBQWUsTUFiZixDQURTO01BQUEsQ0FBYjs7QUFBQSw0QkFpQkEsS0FBQSxHQUFPLFNBQUMsT0FBRCxHQUFBO0FBQ0gsUUFBQSxJQUFJLENBQUMsVUFBTCxDQUFBLENBQUEsQ0FBQTtBQUVBLFFBQUEsSUFBRyxPQUFIO2lCQUNJLElBQUksQ0FBQyxPQUFMLEdB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Ozt5QkFBQTs7UUFESixDQUFBO0FBMEhBLFdBQU8sV0FBUCxDQTNIb0I7RUFBQSxDQU54QixDQUFBLENBQUE7QUFBQSIsImZpbGUiOiJzdy1hbmd1bGFyLXdlYnNvY2tldC5qcyIsInNvdXJjZVJvb3QiOiIvc291cmNlLyIsInNvdXJjZXNDb250ZW50IjpbImFuZ3VsYXIubW9kdWxlKCdzd1dlYlNvY2tldCcsIFtdKVxuXG4uY29uc3RhbnQoJ1dTX1NUQVRVU0VTJywgWydDT05ORUNUSU5HJywgJ09QRU4nLCAnQ0xPU0lORycsICdDTE9TRUQnXSlcbi5jb25zdGFudCgnV1NfQ0xPU0VfU1RBVFVTRVMnLCBbJ0NMT1NJTkcnLCAnQ0xPU0VEJ10pXG4uY29uc3RhbnQoJ1dTX09QRU5fU1RBVFVTJywgJ09QRU4nKVxuXG4uZmFjdG9yeSAnc3dXZWJTb2NrZXQnLCAoJHEsICRpbnRlcnZhbCwgJHRpbWVvdXQsIFdTX1NUQVRVU0VTLCBXU19DTE9TRV9TVEFUVVNFUywgV1NfT1BFTl9TVEFUVVMpIC0+XG4gICAgY2xhc3Mgc3dXZWJTb2NrZXRcbiAgICAgICAgY29uc3RydWN0b3I6ICh3c1VyaSkgLT5cbiAgICAgICAgICAgIHRoaXMud3NVcmkgPSB3c1VyaVxuXG4gICAgICAgICAgICAjIGtlZXAgYWxpdmVcbiAgICAgICAgICAgIHRoaXMuZHVyYWJsZSA9IGZhbHNlXG5cbiAgICAgICAgICAgICMgbWVzc2FnZXMgcXVldWVcbiAgICAgICAgICAgIHRoaXMubWVzc2FnZXNUb1NlbmQgPSBbXVxuXG4gICAgICAgICAgICAjIGhhbmRsZXJzXG4gICAgICAgICAgICB0aGlzLnN0YXJ0SGFuZGxlcnMgPSBbXVxuICAgICAgICAgICAgdGhpcy5tZXNzYWdlSGFuZGxlcnMgPSBbXVxuICAgICAgICAgICAgdGhpcy5lcnJvckhhbmRsZXJzID0gW11cblxuICAgICAgICAgICAgdGhpcy5fc29ja2V0ID0gdW5kZWZpbmVkXG5cblxuICAgICAgICBzdGFydDogKGR1cmFibGUpIC0+XG4gICAgICAgICAgICB0aGlzLl9nZXRTb2NrZXQoKVxuXG4gICAgICAgICAgICBpZiBkdXJhYmxlXG4gICAgICAgICAgICAgICAgdGhpcy5kdXJhYmxlID0gdHJ1ZVxuXG4gICAgICAgIGNsb3NlOiAtPlxuICAgICAgICAgICAgdGhpcy5kdXJhYmxlID0gZmFsc2VcbiAgICAgICAgICAgIHRoaXMuX3NvY2tldC5jbG9zZSgpXG5cblxuICAgICAgICBzZW5kOiAobXNnKSAtPlxuICAgICAgICAgICAgIyBhZGQgbWVzc2FnZSB0byBtZXNzYWdlcyBsaXN0XG4gICAgICAgICAgICB0aGlzLm1lc3NhZ2VzVG9TZW5kLnB1c2gobXNnKVxuXG4gICAgICAgICAgICAjIGluaXQgY29ubmVjdGlvbiBpZiBuZWNlc3NhcnlcbiAgICAgICAgICAgIHRoaXMuX2dldFNvY2tldCgpXG5cblxuICAgICAgICBvblN0YXJ0OiAoY2FsbGJhY2spIC0+XG4gICAgICAgICAgICB0aGlzLnN0YXJ0SGFuZGxlcnMucHVzaCBjYWxsYmFja1xuXG4gICAgICAgIG9uTWVzc2FnZTogKGNhbGxiYWNrKSAtPlxuICAgICAgICAgICAgdGhpcy5tZXNzYWdlSGFuZGxlcnMucHVzaCBjYWxsYmFja1xuXG4gICAgICAgIG9uRXJyb3I6IChjYWxsYmFjaykgLT5cbiAgICAgICAgICAgIHRoaXMuZXJyb3JIYW5kbGVycy5wdXNoIGNhbGxiYWNrXG5cblxuICAgICAgICBnZXRTdGF0dXM6IC0+XG4gICAgICAgICAgICBzdGF0dXMgPSB1bmRlZmluZWRcbiAgICAgICAgICAgIGlmIHRoaXMuX3NvY2tldEV4aXN0cygpXG4gICAgICAgICAgICAgICAgc3RhdHVzID0gV1NfU1RBVFVTRVNbdGhpcy5fc29ja2V0LnJlYWR5U3RhdGVdXG4gICAgICAgICAgICByZXR1cm4gc3RhdHVzXG5cbiAgICAgICAgaXNPcGVuOiAtPlxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0U3RhdHVzKCkgPT0gV1NfT1BFTl9TVEFUVVNcblxuICAgICAgICBpc0Nsb3NlZDogLT5cbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldFN0YXR1cygpIGluIFdTX0NMT1NFX1NUQVRVU0VTXG5cblxuICAgICAgICBfZ2V0U29ja2V0OiAtPlxuICAgICAgICAgICAgaWYgbm90IHRoaXMuX2lzU29ja2V0QWN0aXZlKClcbiAgICAgICAgICAgICAgICB0aGlzLl9zb2NrZXQgPSB0aGlzLl9jcmVhdGVTb2NrZXQoKVxuXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fc29ja2V0XG5cbiAgICAgICAgX2NyZWF0ZVNvY2tldDogKCkgLT5cbiAgICAgICAgICAgIHNvY2tldCA9IG5ldyBXZWJTb2NrZXQodGhpcy53c1VyaSlcblxuICAgICAgICAgICAgc29ja2V0Lm9ub3BlbiA9IChldmVudCkgPT4gdGhpcy5fb25Tb2NrZXRPcGVuKGV2ZW50KVxuICAgICAgICAgICAgc29ja2V0Lm9uY2xvc2UgPSAoZXZlbnQpID0+IHRoaXMuX29uU29ja2V0Q2xvc2UoZXZlbnQpXG4gICAgICAgICAgICBzb2NrZXQub25tZXNzYWdlID0gKGV2ZW50KSA9PiB0aGlzLl9vblNvY2tldE1lc3NhZ2UoZXZlbnQpXG4gICAgICAgICAgICBzb2NrZXQub25lcnJvciA9IChldmVudCkgPT4gdGhpcy5fb25Tb2NrZXRFcnJvcihldmVudClcblxuICAgICAgICAgICAgcmV0dXJuIHNvY2tldFxuXG5cbiAgICAgICAgX29uU29ja2V0T3BlbjogKGV2ZW50KSAtPlxuICAgICAgICAgICAgZm9yIGhhbmRsZXIgaW4gdGhpcy5zdGFydEhhbmRsZXJzXG4gICAgICAgICAgICAgICAgaGFuZGxlcihldmVudC5kYXRhKVxuICAgICAgICAgICAgdGhpcy5fc3RhcnRTZW5kKClcblxuICAgICAgICBfb25Tb2NrZXRFcnJvcjogKGV2ZW50KSAtPlxuICAgICAgICAgICAgZm9yIGhhbmRsZXIgaW4gdGhpcy5lcnJvckhhbmRsZXJzXG4gICAgICAgICAgICAgICAgaGFuZGxlcihldmVudClcblxuICAgICAgICBfb25Tb2NrZXRDbG9zZTogLT5cbiAgICAgICAgICAgIHRoaXMuX3N0b3BTZW5kKClcblxuICAgICAgICAgICAgIyB0cnlpbmcgcmVjb25uZWN0XG4gICAgICAgICAgICBpZiB0aGlzLmR1cmFibGVcbiAgICAgICAgICAgICAgICByZXN0YXJ0Q29ubmVjdGlvbiA9ID0+XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2dldFNvY2tldCgpXG4gICAgICAgICAgICAgICAgJHRpbWVvdXQocmVzdGFydENvbm5lY3Rpb24sIDIwMDApXG5cblxuICAgICAgICBfc3RhcnRTZW5kOiAtPlxuICAgICAgICAgICAgc2VuZE1zZyA9ID0+XG4gICAgICAgICAgICAgICAgd2hpbGUgdGhpcy5fbWVzc2FnZXNFeGlzdHMoKSBhbmQgdGhpcy5faXNTb2NrZXRBY3RpdmUoKVxuICAgICAgICAgICAgICAgICAgICBtc2cgPSB0aGlzLm1lc3NhZ2VzVG9TZW5kLnNoaWZ0KClcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZ2V0U29ja2V0KCkuc2VuZChtc2cpXG5cbiAgICAgICAgICAgICMgcGVyaW9kaWNhbGx5IHRyeSBzZW5kIG1lc3NhZ2VzIGZyb20gcXVldWVcbiAgICAgICAgICAgIHRoaXMuc3RvcFNlbmRQcm9taXNlID0gJGludGVydmFsKHNlbmRNc2csIDUwMClcblxuICAgICAgICBfc3RvcFNlbmQ6IC0+XG4gICAgICAgICAgICBpZiB0aGlzLnN0b3BTZW5kUHJvbWlzZSAhPSB1bmRlZmluZWRcbiAgICAgICAgICAgICAgICAkaW50ZXJ2YWwuY2FuY2VsKHRoaXMuc3RvcFNlbmRQcm9taXNlKVxuXG5cblxuICAgICAgICBfc29ja2V0RXhpc3RzOiAtPlxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NvY2tldCAhPSB1bmRlZmluZWRcblxuICAgICAgICBfaXNTb2NrZXRBY3RpdmU6IC0+XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fc29ja2V0RXhpc3RzKCkgYW5kIG5vdCB0aGlzLmlzQ2xvc2VkKClcblxuICAgICAgICBfbWVzc2FnZXNFeGlzdHM6IC0+XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5tZXNzYWdlc1RvU2VuZC5sZW5ndGggPiAwXG5cblxuXG4gICAgcmV0dXJuIHN3V2ViU29ja2V0Il19