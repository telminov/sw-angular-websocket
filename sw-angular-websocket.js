(function() {
  var indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

  angular.module('swWebSocket', []).constant('WS_STATUSES', ['CONNECTING', 'OPEN', 'CLOSING', 'CLOSED']).constant('WS_CLOSE_STATUSES', ['CLOSING', 'CLOSED']).constant('WS_OPEN_STATUS', 'OPEN').factory('swWebSocket', function($q, $interval, $timeout, WS_STATUSES, WS_CLOSE_STATUSES, WS_OPEN_STATUS) {
    var swWebSocket;
    swWebSocket = (function() {
      function swWebSocket(wsUri) {
        this.wsUri = wsUri;
        this.durable = false;
        this.messagesToSend = [];
        this.startHandlers = [];
        this.messageHandlers = [];
        this.errorHandlers = [];
        this._socket = void 0;
      }

      swWebSocket.prototype.start = function(durable) {
        this._getSocket();
        if (durable) {
          return this.durable = true;
        }
      };

      swWebSocket.prototype.close = function() {
        this.durable = false;
        return this._socket.close();
      };

      swWebSocket.prototype.send = function(msg) {
        this.messagesToSend.push(msg);
        return this._getSocket();
      };

      swWebSocket.prototype.onStart = function(callback) {
        return this.startHandlers.push(callback);
      };

      swWebSocket.prototype.onMessage = function(callback) {
        return this.messageHandlers.push(callback);
      };

      swWebSocket.prototype.onError = function(callback) {
        return this.errorHandlers.push(callback);
      };

      swWebSocket.prototype.getStatus = function() {
        var status;
        status = void 0;
        if (this._socketExists()) {
          status = WS_STATUSES[this._socket.readyState];
        }
        return status;
      };

      swWebSocket.prototype.isOpen = function() {
        return this.getStatus() === WS_OPEN_STATUS;
      };

      swWebSocket.prototype.isClosed = function() {
        var ref;
        return ref = this.getStatus(), indexOf.call(WS_CLOSE_STATUSES, ref) >= 0;
      };

      swWebSocket.prototype._getSocket = function() {
        if (!this._isSocketActive()) {
          this._socket = this._createSocket();
        }
        return this._socket;
      };

      swWebSocket.prototype._createSocket = function() {
        var socket;
        socket = new WebSocket(this.wsUri);
        socket.onopen = (function(_this) {
          return function(event) {
            return _this._onSocketOpen(event);
          };
        })(this);
        socket.onclose = (function(_this) {
          return function(event) {
            return _this._onSocketClose(event);
          };
        })(this);
        socket.onmessage = (function(_this) {
          return function(event) {
            return _this._onSocketMessage(event);
          };
        })(this);
        return socket;
      };

      swWebSocket.prototype._onSocketOpen = function(event) {
        var handler, i, len, ref;
        ref = this.startHandlers;
        for (i = 0, len = ref.length; i < len; i++) {
          handler = ref[i];
          handler(event.data);
        }
        return this._startSend();
      };

      swWebSocket.prototype._onSocketMessage = function(event) {
        var handler, i, len, ref, results;
        ref = this.messageHandlers;
        results = [];
        for (i = 0, len = ref.length; i < len; i++) {
          handler = ref[i];
          results.push(handler(event.data));
        }
        return results;
      };

      swWebSocket.prototype._onSocketClose = function() {
        var restartConnection;
        this._stopSend();
        if (this.durable) {
          restartConnection = (function(_this) {
            return function() {
              return _this._getSocket();
            };
          })(this);
          return $timeout(restartConnection, 2000);
        }
      };

      swWebSocket.prototype._startSend = function() {
        var sendMsg;
        sendMsg = (function(_this) {
          return function() {
            var msg, results;
            results = [];
            while (_this._messagesExists() && _this._isSocketActive()) {
              msg = _this.messagesToSend.shift();
              results.push(_this._getSocket().send(msg));
            }
            return results;
          };
        })(this);
        return this.stopSendPromise = $interval(sendMsg, 500);
      };

      swWebSocket.prototype._stopSend = function() {
        if (this.stopSendPromise !== void 0) {
          return $interval.cancel(this.stopSendPromise);
        }
      };

      swWebSocket.prototype._socketExists = function() {
        return this._socket !== void 0;
      };

      swWebSocket.prototype._isSocketActive = function() {
        return this._socketExists() && !this.isClosed();
      };

      swWebSocket.prototype._messagesExists = function() {
        return this.messagesToSend.length > 0;
      };

      return swWebSocket;

    })();
    return swWebSocket;
  });

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInN3LWFuZ3VsYXItd2Vic29ja2V0LmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUFBLE1BQUEsbUpBQUE7O0FBQUEsRUFBQSxPQUFPLENBQUMsTUFBUixDQUFlLGFBQWYsRUFBOEIsRUFBOUIsQ0FFQSxDQUFDLFFBRkQsQ0FFVSxhQUZWLEVBRXlCLENBQUMsWUFBRCxFQUFlLE1BQWYsRUFBdUIsU0FBdkIsRUFBa0MsUUFBbEMsQ0FGekIsQ0FHQSxDQUFDLFFBSEQsQ0FHVSxtQkFIVixFQUcrQixDQUFDLFNBQUQsRUFBWSxRQUFaLENBSC9CLENBSUEsQ0FBQyxRQUpELENBSVUsZ0JBSlYsRUFJNEIsTUFKNUIsQ0FNQSxDQUFDLE9BTkQsQ0FNUyxhQU5ULEVBTXdCLFNBQUMsRUFBRCxFQUFLLFNBQUwsRUFBZ0IsUUFBaEIsRUFBMEIsV0FBMUIsRUFBdUMsaUJBQXZDLEVBQTBELGNBQTFELEdBQUE7QUFDcEIsUUFBQSxXQUFBO0FBQUEsSUFBTTtBQUNXLE1BQUEscUJBQUMsS0FBRCxHQUFBO0FBQ1QsUUFBQSxJQUFJLENBQUMsS0FBTCxHQUFhLEtBQWIsQ0FBQTtBQUFBLFFBR0EsSUFBSSxDQUFDLE9BQUwsR0FBZSxLQUhmLENBQUE7QUFBQSxRQU1BLElBQUksQ0FBQyxjQUFMLEdBQXNCLEVBTnRCLENBQUE7QUFBQSxRQVNBLElBQUksQ0FBQyxhQUFMLEdBQXFCLEVBVHJCLENBQUE7QUFBQSxRQVVBLElBQUksQ0FBQyxlQUFMLEdBQXVCLEVBVnZCLENBQUE7QUFBQSxRQVdBLElBQUksQ0FBQyxhQUFMLEdBQXFCLEVBWHJCLENBQUE7QUFBQSxRQWFBLElBQUksQ0FBQyxPQUFMLEdBQWUsTUFiZixDQURTO01BQUEsQ0FBYjs7QUFBQSw0QkFpQkEsS0FBQSxHQUFPLFNBQUMsT0FBRCxHQUFBO0FBQ0gsUUFBQSxJQUFJLENBQUMsVUFBTCxDQUFBLENBQUEsQ0FBQTtBQUVBLFFBQUEsSUFBRyxPQUFIO2lCQUNJLElBQUksQ0FBQyxPQUFMLEdB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QyxlQUFMLENBQUEsQ0FBakMsR0FBQTtBQUNJLGNBQUEsR0FBQSxHQUFNLEtBQUksQ0FBQyxjQUFjLENBQUMsS0FBcEIsQ0FBQSxDQUFOLENBQUE7QUFBQSwyQkFDQSxLQUFJLENBQUMsVUFBTCxDQUFBLENBQWlCLENBQUMsSUFBbEIsQ0FBdUIsR0FBdkIsRUFEQSxDQURKO1lBQUEsQ0FBQTsyQkFETTtVQUFBLEVBQUE7UUFBQSxDQUFBLENBQUEsQ0FBQSxJQUFBLENBQVYsQ0FBQTtlQU1BLElBQUksQ0FBQyxlQUFMLEdBQXVCLFNBQUEsQ0FBVSxPQUFWLEVBQW1CLEdBQW5CLEVBUGY7TUFBQSxDQTlGWixDQUFBOztBQUFBLDRCQXVHQSxTQUFBLEdBQVcsU0FBQSxHQUFBO0FBQ1AsUUFBQSxJQUFHLElBQUksQ0FBQyxlQUFMLEtBQXdCLE1BQTNCO2lCQUNJLFNBQVMsQ0FBQyxNQUFWLENBQWlCLElBQUksQ0FBQyxlQUF0QixFQURKO1NBRE87TUFBQSxDQXZHWCxDQUFBOztBQUFBLDRCQTZHQSxhQUFBLEdBQWUsU0FBQSxHQUFBO0FBQ1gsZUFBTyxJQUFJLENBQUMsT0FBTCxLQUFnQixNQUF2QixDQURXO01BQUEsQ0E3R2YsQ0FBQTs7QUFBQSw0QkFnSEEsZUFBQSxHQUFpQixTQUFBLEdBQUE7QUFDYixlQUFPLElBQUksQ0FBQyxhQUFMLENBQUEsQ0FBQSxJQUF5QixDQUFBLElBQVEsQ0FBQyxRQUFMLENBQUEsQ0FBcEMsQ0FEYTtNQUFBLENBaEhqQixDQUFBOztBQUFBLDRCQW1IQSxlQUFBLEdBQWlCLFNBQUEsR0FBQTtBQUNiLGVBQU8sSUFBSSxDQUFDLGNBQWMsQ0FBQyxNQUFwQixHQUE2QixDQUFwQyxDQURhO01BQUEsQ0FuSGpCLENBQUE7O3lCQUFBOztRQURKLENBQUE7QUF5SEEsV0FBTyxXQUFQLENBMUhvQjtFQUFBLENBTnhCLENBQUEsQ0FBQTtBQUFBIiwiZmlsZSI6InN3LWFuZ3VsYXItd2Vic29ja2V0LmpzIiwic291cmNlUm9vdCI6Ii9zb3VyY2UvIiwic291cmNlc0NvbnRlbnQiOlsiYW5ndWxhci5tb2R1bGUoJ3N3V2ViU29ja2V0JywgW10pXG5cbi5jb25zdGFudCgnV1NfU1RBVFVTRVMnLCBbJ0NPTk5FQ1RJTkcnLCAnT1BFTicsICdDTE9TSU5HJywgJ0NMT1NFRCddKVxuLmNvbnN0YW50KCdXU19DTE9TRV9TVEFUVVNFUycsIFsnQ0xPU0lORycsICdDTE9TRUQnXSlcbi5jb25zdGFudCgnV1NfT1BFTl9TVEFUVVMnLCAnT1BFTicpXG5cbi5mYWN0b3J5ICdzd1dlYlNvY2tldCcsICgkcSwgJGludGVydmFsLCAkdGltZW91dCwgV1NfU1RBVFVTRVMsIFdTX0NMT1NFX1NUQVRVU0VTLCBXU19PUEVOX1NUQVRVUykgLT5cbiAgICBjbGFzcyBzd1dlYlNvY2tldFxuICAgICAgICBjb25zdHJ1Y3RvcjogKHdzVXJpKSAtPlxuICAgICAgICAgICAgdGhpcy53c1VyaSA9IHdzVXJpXG5cbiAgICAgICAgICAgICMga2VlcCBhbGl2ZVxuICAgICAgICAgICAgdGhpcy5kdXJhYmxlID0gZmFsc2VcblxuICAgICAgICAgICAgIyBtZXNzYWdlcyBxdWV1ZVxuICAgICAgICAgICAgdGhpcy5tZXNzYWdlc1RvU2VuZCA9IFtdXG5cbiAgICAgICAgICAgICMgaGFuZGxlcnNcbiAgICAgICAgICAgIHRoaXMuc3RhcnRIYW5kbGVycyA9IFtdXG4gICAgICAgICAgICB0aGlzLm1lc3NhZ2VIYW5kbGVycyA9IFtdXG4gICAgICAgICAgICB0aGlzLmVycm9ySGFuZGxlcnMgPSBbXVxuXG4gICAgICAgICAgICB0aGlzLl9zb2NrZXQgPSB1bmRlZmluZWRcblxuXG4gICAgICAgIHN0YXJ0OiAoZHVyYWJsZSkgLT5cbiAgICAgICAgICAgIHRoaXMuX2dldFNvY2tldCgpXG5cbiAgICAgICAgICAgIGlmIGR1cmFibGVcbiAgICAgICAgICAgICAgICB0aGlzLmR1cmFibGUgPSB0cnVlXG5cbiAgICAgICAgY2xvc2U6IC0+XG4gICAgICAgICAgICB0aGlzLmR1cmFibGUgPSBmYWxzZVxuICAgICAgICAgICAgdGhpcy5fc29ja2V0LmNsb3NlKClcblxuXG4gICAgICAgIHNlbmQ6IChtc2cpIC0+XG4gICAgICAgICAgICAjIGFkZCBtZXNzYWdlIHRvIG1lc3NhZ2VzIGxpc3RcbiAgICAgICAgICAgIHRoaXMubWVzc2FnZXNUb1NlbmQucHVzaChtc2cpXG5cbiAgICAgICAgICAgICMgaW5pdCBjb25uZWN0aW9uIGlmIG5lY2Vzc2FyeVxuICAgICAgICAgICAgdGhpcy5fZ2V0U29ja2V0KClcblxuXG4gICAgICAgIG9uU3RhcnQ6IChjYWxsYmFjaykgLT5cbiAgICAgICAgICAgIHRoaXMuc3RhcnRIYW5kbGVycy5wdXNoIGNhbGxiYWNrXG5cbiAgICAgICAgb25NZXNzYWdlOiAoY2FsbGJhY2spIC0+XG4gICAgICAgICAgICB0aGlzLm1lc3NhZ2VIYW5kbGVycy5wdXNoIGNhbGxiYWNrXG5cbiAgICAgICAgb25FcnJvcjogKGNhbGxiYWNrKSAtPlxuICAgICAgICAgICAgdGhpcy5lcnJvckhhbmRsZXJzLnB1c2ggY2FsbGJhY2tcblxuXG4gICAgICAgIGdldFN0YXR1czogLT5cbiAgICAgICAgICAgIHN0YXR1cyA9IHVuZGVmaW5lZFxuICAgICAgICAgICAgaWYgdGhpcy5fc29ja2V0RXhpc3RzKClcbiAgICAgICAgICAgICAgICBzdGF0dXMgPSBXU19TVEFUVVNFU1t0aGlzLl9zb2NrZXQucmVhZHlTdGF0ZV1cbiAgICAgICAgICAgIHJldHVybiBzdGF0dXNcblxuICAgICAgICBpc09wZW46IC0+XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRTdGF0dXMoKSA9PSBXU19PUEVOX1NUQVRVU1xuXG4gICAgICAgIGlzQ2xvc2VkOiAtPlxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0U3RhdHVzKCkgaW4gV1NfQ0xPU0VfU1RBVFVTRVNcblxuXG4gICAgICAgIF9nZXRTb2NrZXQ6IC0+XG4gICAgICAgICAgICBpZiBub3QgdGhpcy5faXNTb2NrZXRBY3RpdmUoKVxuICAgICAgICAgICAgICAgIHRoaXMuX3NvY2tldCA9IHRoaXMuX2NyZWF0ZVNvY2tldCgpXG5cbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zb2NrZXRcblxuICAgICAgICBfY3JlYXRlU29ja2V0OiAoKSAtPlxuICAgICAgICAgICAgc29ja2V0ID0gbmV3IFdlYlNvY2tldCh0aGlzLndzVXJpKVxuXG4gICAgICAgICAgICBzb2NrZXQub25vcGVuID0gKGV2ZW50KSA9PiB0aGlzLl9vblNvY2tldE9wZW4oZXZlbnQpXG4gICAgICAgICAgICBzb2NrZXQub25jbG9zZSA9IChldmVudCkgPT4gdGhpcy5fb25Tb2NrZXRDbG9zZShldmVudClcbiAgICAgICAgICAgIHNvY2tldC5vbm1lc3NhZ2UgPSAoZXZlbnQpID0+IHRoaXMuX29uU29ja2V0TWVzc2FnZShldmVudClcblxuICAgICAgICAgICAgcmV0dXJuIHNvY2tldFxuXG5cbiAgICAgICAgX29uU29ja2V0T3BlbjogKGV2ZW50KSAtPlxuICAgICAgICAgICAgZm9yIGhhbmRsZXIgaW4gdGhpcy5zdGFydEhhbmRsZXJzXG4gICAgICAgICAgICAgICAgaGFuZGxlcihldmVudC5kYXRhKVxuICAgICAgICAgICAgdGhpcy5fc3RhcnRTZW5kKClcblxuICAgICAgICBfb25Tb2NrZXRNZXNzYWdlOiAoZXZlbnQpIC0+XG4gICAgICAgICAgICBmb3IgaGFuZGxlciBpbiB0aGlzLm1lc3NhZ2VIYW5kbGVyc1xuICAgICAgICAgICAgICAgIGhhbmRsZXIoZXZlbnQuZGF0YSlcblxuICAgICAgICBfb25Tb2NrZXRDbG9zZTogLT5cbiAgICAgICAgICAgIHRoaXMuX3N0b3BTZW5kKClcblxuICAgICAgICAgICAgIyB0cnlpbmcgcmVjb25uZWN0XG4gICAgICAgICAgICBpZiB0aGlzLmR1cmFibGVcbiAgICAgICAgICAgICAgICByZXN0YXJ0Q29ubmVjdGlvbiA9ID0+XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2dldFNvY2tldCgpXG4gICAgICAgICAgICAgICAgJHRpbWVvdXQocmVzdGFydENvbm5lY3Rpb24sIDIwMDApXG5cblxuICAgICAgICBfc3RhcnRTZW5kOiAtPlxuICAgICAgICAgICAgc2VuZE1zZyA9ID0+XG4gICAgICAgICAgICAgICAgd2hpbGUgdGhpcy5fbWVzc2FnZXNFeGlzdHMoKSBhbmQgdGhpcy5faXNTb2NrZXRBY3RpdmUoKVxuICAgICAgICAgICAgICAgICAgICBtc2cgPSB0aGlzLm1lc3NhZ2VzVG9TZW5kLnNoaWZ0KClcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZ2V0U29ja2V0KCkuc2VuZChtc2cpXG5cbiAgICAgICAgICAgICMgcGVyaW9kaWNhbGx5IHRyeSBzZW5kIG1lc3NhZ2VzIGZyb20gcXVldWVcbiAgICAgICAgICAgIHRoaXMuc3RvcFNlbmRQcm9taXNlID0gJGludGVydmFsKHNlbmRNc2csIDUwMClcblxuICAgICAgICBfc3RvcFNlbmQ6IC0+XG4gICAgICAgICAgICBpZiB0aGlzLnN0b3BTZW5kUHJvbWlzZSAhPSB1bmRlZmluZWRcbiAgICAgICAgICAgICAgICAkaW50ZXJ2YWwuY2FuY2VsKHRoaXMuc3RvcFNlbmRQcm9taXNlKVxuXG5cblxuICAgICAgICBfc29ja2V0RXhpc3RzOiAtPlxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NvY2tldCAhPSB1bmRlZmluZWRcblxuICAgICAgICBfaXNTb2NrZXRBY3RpdmU6IC0+XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fc29ja2V0RXhpc3RzKCkgYW5kIG5vdCB0aGlzLmlzQ2xvc2VkKClcblxuICAgICAgICBfbWVzc2FnZXNFeGlzdHM6IC0+XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5tZXNzYWdlc1RvU2VuZC5sZW5ndGggPiAwXG5cblxuXG4gICAgcmV0dXJuIHN3V2ViU29ja2V0Il19