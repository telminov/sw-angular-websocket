(function(){var indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};angular.module("swWebSocket",[]).constant("WS_STATUSES",["CONNECTING","OPEN","CLOSING","CLOSED"]).constant("WS_CLOSE_STATUSES",["CLOSING","CLOSED"]).constant("WS_OPEN_STATUS","OPEN").factory("swWebSocket",function($q,$interval,$timeout,WS_STATUSES,WS_CLOSE_STATUSES,WS_OPEN_STATUS){var swWebSocket;return swWebSocket=function(){function swWebSocket(wsUri){this.wsUri=wsUri,this.durable=!1,this.messagesToSend=[],this.startHandlers=[],this.messageHandlers=[],this.errorHandlers=[],this._socket=void 0}return swWebSocket.prototype.start=function(durable){return this._getSocket(),durable?this.durable=!0:void 0},swWebSocket.prototype.close=function(){return this.durable=!1,this._socket.close()},swWebSocket.prototype.send=function(msg){return this.messagesToSend.push(msg),this._getSocket()},swWebSocket.prototype.onStart=function(callback){return this.startHandlers.push(callback)},swWebSocket.prototype.onMessage=function(callback){return this.messageHandlers.push(callback)},swWebSocket.prototype.onError=function(callback){return this.errorHandlers.push(callback)},swWebSocket.prototype.getStatus=function(){var status;return status=void 0,this._socketExists()&&(status=WS_STATUSES[this._socket.readyState]),status},swWebSocket.prototype.isOpen=function(){return this.getStatus()===WS_OPEN_STATUS},swWebSocket.prototype.isClosed=function(){var ref;return ref=this.getStatus(),indexOf.call(WS_CLOSE_STATUSES,ref)>=0},swWebSocket.prototype._getSocket=function(){return this._isSocketActive()||(this._socket=this._createSocket()),this._socket},swWebSocket.prototype._createSocket=function(){var socket;return socket=new WebSocket(this.wsUri),socket.onopen=function(_this){return function(event){return _this._onSocketOpen(event)}}(this),socket.onclose=function(_this){return function(event){return _this._onSocketClose(event)}}(this),socket.onmessage=function(_this){return function(event){return _this._onSocketMessage(event)}}(this),socket},swWebSocket.prototype._onSocketOpen=function(event){var handler,i,len,ref;for(ref=this.startHandlers,i=0,len=ref.length;len>i;i++)(handler=ref[i])(event.data);return this._startSend()},swWebSocket.prototype._onSocketMessage=function(event){var handler,i,len,ref,results;for(ref=this.messageHandlers,results=[],i=0,len=ref.length;len>i;i++)handler=ref[i],results.push(handler(event.data));return results},swWebSocket.prototype._onSocketClose=function(){var restartConnection;return this._stopSend(),this.durable?(restartConnection=function(_this){return function(){return _this._getSocket()}}(this),$timeout(restartConnection,2e3)):void 0},swWebSocket.prototype._startSend=function(){var sendMsg;return sendMsg=function(_this){return function(){var msg,results;for(results=[];_this._messagesExists()&&_this._isSocketActive();)msg=_this.messagesToSend.shift(),results.push(_this._getSocket().send(msg));return results}}(this),this.stopSendPromise=$interval(sendMsg,500)},swWebSocket.prototype._stopSend=function(){return void 0!==this.stopSendPromise?$interval.cancel(this.stopSendPromise):void 0},swWebSocket.prototype._socketExists=function(){return void 0!==this._socket},swWebSocket.prototype._isSocketActive=function(){return this._socketExists()&&!this.isClosed()},swWebSocket.prototype._messagesExists=function(){return this.messagesToSend.length>0},swWebSocket}()})}).call(this);